---
title: 'Junit, 제대로 알고 쓰기'
date: 2023-05-31 02:05:57
category: 'back-end'
profile : 'https://refrigerator-image.s3.ap-northeast-2.amazonaws.com/icon/IMG_9705.JPG'
author: '김나현'
draft: false
---

안녕하세요. 냉장고를 부탁해 프로젝트에서 서버 개발자를 맡고 있는 김나현입니다.

이번 글에선 JUnit을 사용하며 겪은 삽질 일화를 풀어보려고 합니다.

### 🛠️ 야심차게 시작한 테스트 개선 작업

때는 5월. 어느 정도 구현을 끝낸 시점에서 리팩터링 작업을 시작했습니다.

저는 본 코드를 먼저 리팩터링하지 않고 테스트부터 리팩터링을 진행했는데요. 왜냐하면 본 코드를 작성할 때는 <br>**이런 에러가 발생하지 않을까? 🧐** 혹은 **조금 더 효율적인 방법이 없을까? 🤨** 고민하면서 짰지만,<br>
테스트 코드는 “미리 짜놓은 시나리오대로 돌아가기만 하면 된다 !!” 라는 안일한 생각으로 짰기 때문에 <br>허술한 점이 많을 거라 예상되었습니다.

![](https://mblogthumb-phinf.pstatic.net/MjAyMDA5MzBfMjc0/MDAxNjAxNDU0NjQ3Njcx.3fOvoqIznojDYjpiFMGgn4Q_IkxP8Dfp4qKvFRV4RRMg.rn4-2rkOFixHfsqA_UYZ7gIsvXkijYRWmrMlqF69hGsg.JPEG.yunny_23/07A35464-9780-4214-B06B-C991390E2A24-1005-000000748EE6D345_file.jpg?type=w800)

그런데... 역시 ...<br>
아무렇게나 짠 코드는 정말 **아무렇게**, **얼렁뚱땅** 돌아가고 있었습니다.

#### 👥 그래서 JUnit4를 쓸 거냐, JUnit5를 쓸 거냐?

저는 JUnit을 영한 님의 강의를 보며 어깨 너머로 익혔던지라 JUnit을 잘 모르고 있었습니다.🥲 <br>

딱히 JUnit을 깊게 공부하지 않아도 웬만한 테스트 코드는 다 짤 수 있었기 때문이죠..

![](https://i.pinimg.com/736x/ac/d6/80/acd6805bc1d7da4f716928be45c3c1fa.jpg)

하지만 .. 무소식이 희소식일 줄 알았던 JUnit은 조용히 재앙을 준비하고 있었습니다. 

바로 어느 순간부터 .. 처음 짤 땐 잘 돌아가던 코드가 다음 날이 되면, <br>혹은 일주일이 지나면 돌아가지 않는 현상이 발생했습니다. 코드는 변경된게 없는데 말이죠.

<img width="493" alt="스크린샷 2023-05-31 오전 12 58 45" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/fc3bf494-4f49-4ef2-85ac-1583555e5533">

때는 추천 검색어를 조회 통합테스트를 진행할 때였습니다.

##### [추천 검색어 조회 테스트에서 검증할 내용]
- 유통기한이 얼마 안 남은 식재료 중 **상위 5개** 추출.
- 단, **중복된 식재료가 없이** 상위 5개가 추출되어야 한다.
- 이러한 조건을 만족하는 쿼리문을 작성했고, 쿼리문이 제대로 돌아가는지 테스트할 것.

<br>

여느 때와 다름 없이 테스트 클래스를 만들고, @Before을 선언해서 본 테스트를 실행하기 전 미리 테스트 데이터를 넣어두었습니다. <br>
그런 다음 테스트를 실행했습니다.

<img width="800" alt="스크린샷 2023-05-31 오전 12 54 45" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/f4afb971-45e0-4b92-8eb4-64ad90b88bb5">

하지만 .. 테스트는 제대로 돌아가지 않았습니다.

실제 결과값은 3이 나와야 하는데, 추천 검색어가 제대로 조회되지 않아 결과가 0으로 떠서 테스트가 실패한 것입니다. <br> 대체 왜 이런 결과가 나온 걸까요?

####**예상 원인 1. 테스트 데이터가 제대로 들어가지 않았나?**

일단 @Before 어노테이션이 붙은 init() 메서드에 log를 남겨보았습니다.

그런데 log가 찍히지 않았습니다. 이건 @Before 메서드가 제대로 작동되지 않고 있다는 뜻입니다.

이 문제의 원인을 찾기 위해 여기저기 구글링 해본 결과, <br>
"이게 확실한 문제다!" 는 아니지만, 아무래도 JUnit 버전 충돌 문제 때문인 것 같았습니다.

<img width="518" alt="스크린샷 2023-05-31 오전 1 00 31" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/b28d70bd-b656-4112-8600-7051d7a8b3d9">

현재 프로젝트의 Gradle은 JUnit4와 JUnit5 버전 둘 다 의존하고 있었습니다. <br>
이것이 왜 문제가 되냐면 JUnit4와 JUnit5는 엄연히 다른 라이브러리이며, 어노테이션 사용 방법이 다릅니다. 

예를 들어 JUnit4에선 @Before을 쓴다면, @JUnit5에선 @BeforeEach 나 @BeforeAll을 사용합니다.

즉, 둘은 엄연히 다른 라이브러리고 두 버전이 함께 의존성을 갖고 있으니 저도 모르는 새에 두 버전이 충돌하지 않았나 싶습니다. 

뭐, 이유가 어찌됐든 두 가지 버전을 모두 사용할 수 없으니 하나만 쓰는 방향으로 변경해야겠죠?

저는 JUnit5 버전을 사용하기로 했습니다.<br>
일단 제가 무의식적으로 알고 있는 JUnit 지식이 대부분 5 버전에 맞춰져 있었습니다. <br>
또한 요즘은 JUnit4 보다는 JUnit5로 많이 넘어가는 추세이기도 합니다.

그렇게 호기롭게 JUnit의 의존성을 지우고, JUnit5만 남긴 채 코끼리를 돌렸는데요 ...

<img width="499" alt="스크린샷 2023-05-31 오전 1 04 31" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/5a120a2d-5579-4356-8699-779fa8cc4214">


이런, 문제가 발생했습니다. 버전을 바꾼다는 것은 엄청난 노가다를 요구하는 행위였습니다. 😭 

JUnit 4버전을 제거하는 순간 JUnit4에서만 사용되는 어노테이션이 모두 빨간줄로 바뀌었기 때문이죠.. 😱

Controller 통합 테스트에서 사용되던 @RunWith 부터 시작해서 @Before 까지. <br> 이것들을 일일이 다 변경해줘야 했습니다. 

![](data:image/jpeg;base64,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)

그렇게 노가다(?)를 하며 JUnit5에 맞는 어노테이션으로 변경해주었습니다. 

~~(이 과정을 거치며 .. <br>
테스트에서 공통적으로 사용하는 어노테이션이나 코드는 따로 클래스를 만들어 정의해주고, <br> 그걸 상속받아 사용하는 게 어떻까 하는 생각이 들었습니다... <br>
상여자특 : 소잃고 외양간 고침)~~

하지만 산 넘어 산 이었습니다. 

<img width="1240" alt="스크린샷 2023-05-31 오전 1 12 43" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/b9b3c0ff-20f5-49f9-bb2d-b3ab7b6fc2ef">

> org.junit.platform.commons.JUnitException: @BeforeAll method 'void refrigerator.back.searchword.transactiontest.TransactionATest.init()' must be static unless the test class is annotated with @TestInstance(Lifecycle.PER_CLASS).

에러 코드를 살펴보니 @BeforeAll을 사용하려면 @BeforeAll 의 메서드를 정적으로 생성하거나, <br>테스트의 생명 주기를 변경해줘야 한다고 합니다.

<img width="1146" alt="스크린샷 2023-05-31 오전 3 16 08" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/b989437c-3000-46a8-a4eb-1cf838fdd934">

JUnit Docs에서 자세히 찾아보면, <br>
@BeforeAll은 static 메서드에서만 사용이 가능하며 @TestInstance를 통해 생명 주기를 변경할 수 있지만, <br>Java 16 버전부터 해당 방식은 더 이상 적용되지 않는다고 합니다.

저는 지금까지 @Before 과 @BeforeAll이 동일하다고 착각하고 있었습니다.<br> 

그래서 당연히 @Before 대신 @BeforeAll을 적용했지만, 반대로 @Before은 @BeforeEach와 동일하며 모든 테스트마다 한번씩 실행되는 것이었습니다.


다시 추천 검색어 조회 테스트로 돌아와서 코드를 살펴봅시다. 

<img width="1179" alt="스크린샷 2023-05-31 오전 1 43 27" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/73ef7726-d040-41c5-a47c-ea76c5dc202a">

위 코드의 init() 메서드에선 {사과, 사과, 배, 소고기, 소고기}와 같이 중복된 식재료가 있는 데이터를 DB에 넣고 <br> {오이, 당근}과 같이 삭제된 식재료를 DB에 넣어두는 로직입니다.

그렇담, 이 코드는 @BeforeAll이 어울릴까요, 아니면 @BeforeEach가 어울릴까요?

제 상황에선 @BeforeEach가 맞습니다.

> javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process 'persist' call

@BeforeAll을 사용하면 위와 같은 오류가 뜨는데요.

일단 static으로 init() 메서드를 사용하면 EntityManager와 같이 의존성 주입이 필요한 객체를 받지 못합니다. <br>
@TestInstance를 통해 테스트 생명주기를 변경하여 사용한다고 해도, <br>Java 16 버전 부터는 지원되지 않는 방식이며, static 방법과 동일하게 의존성 주입을 받지 못합니다.

그렇게 ..!

@BeforeEach를 적용하고 **이제는 되겠지?** 두근거리는 마음으로 테스트를 실행했습니다. 😙

<img width="796" alt="스크린샷 2023-05-31 오전 2 01 49" src="https://github.com/xiu0327/2023-refrigerator-recipe/assets/78461009/474196b8-cdbd-4c21-a6c4-e8746e6252df">


테스트가 잘 돌아가는 것을 확인했습니다 ! 😀
